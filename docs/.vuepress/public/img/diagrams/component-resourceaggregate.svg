<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2480 2702"><g transform="translate(689 581)"><rect width="1020" height="1613" rx="0" ry="0" fill="#fff" stroke="#444" stroke-width="2" stroke-dasharray="20, 20" pointer-events="none"/><text font-size="24" y="1574" fill="#444" x="10" pointer-events="visible" font-family="'Open Sans'" transform="translate(15)"><tspan dy="0em" x="0">Resource Aggregate</tspan></text><text font-size="19" y="1598" fill="#444" x="10" pointer-events="visible" font-family="'Open Sans'" transform="translate(15)"><tspan dy="0em" x="0">[Container]</tspan></text></g><g transform="translate(230 1)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 77.5)"><tspan dy="0em" x="0">Protocol Adapter</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 117.5)"><tspan dy="0em" x="0">from CoAP Gateway</tspan><tspan dy="1.2em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 192.5)"><tspan dy="0em" x="0">Translates OCF protocol</tspan></text><image/></g><g transform="translate(980 1)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 77.5)"><tspan dy="0em" x="0">Protocol Adapter</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 117.5)"><tspan dy="0em" x="0">from gRPC Gateway</tspan><tspan dy="1.2em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 192.5)"><tspan dy="0em" x="0">Translates public gRPC protocol</tspan></text><image/></g><g transform="translate(980 601)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 90)"><tspan dy="0em" x="0">Command Handler</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 130)"><tspan dy="0em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 180)"><tspan dy="0em" x="0">Validates received commands</tspan></text><image/></g><g transform="translate(1800 601)"><rect rx="1" ry="1" stroke="#c7c7c7" stroke-width="2" pointer-events="visiblePainted" fill="#ddd" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 75)"><tspan dy="0em" x="0">Authorization Server</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 115)"><tspan dy="0em" x="0">[Software System]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 165)"><tspan dy="0em" x="0">An OAuth2.0 server authorizing and</tspan><tspan dy="1.2em" x="0">storing users and devices identities</tspan></text><image/></g><g transform="translate(959 1201)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 60)"><tspan dy="0em" x="0">Aggregate Component</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 100)"><tspan dy="0em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 150)"><tspan dy="0em" x="0">Handles commands and ensurer that</tspan><tspan dy="1.2em" x="0">event writes respect the business</tspan><tspan dy="1.2em" x="0">invariant</tspan></text><image/></g><g transform="translate(1730 1)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 77.5)"><tspan dy="0em" x="0">Protocol Adapter</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 117.5)"><tspan dy="0em" x="0">from HTTP Gateway</tspan><tspan dy="1.2em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 192.5)"><tspan dy="0em" x="0">Translates HTTP protocol</tspan></text><image/></g><g transform="translate(709 1801)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 90)"><tspan dy="0em" x="0">Event Bus Component</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 130)"><tspan dy="0em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 180)"><tspan dy="0em" x="0">Publishes validated events</tspan></text><image/></g><g transform="translate(1239 1801)"><rect rx="1" ry="1" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" width="450" height="300"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 90)"><tspan dy="0em" x="0">Event Store Component</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 130)"><tspan dy="0em" x="0">[Component]</tspan></text><text font-size="24" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 180)"><tspan dy="0em" x="0">Saves events</tspan></text><image/></g><g transform="translate(1314 2401)"><ellipse id="a" cx="150" cy="270" rx="150" ry="30" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1"/><path id="b" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" d="M0 30h300v240H0z"/><clipPath id="c" clipPathUnits="userSpaceOnUse"><use xlink:href="#a" width="100%" height="100%"/><use xlink:href="#b" width="100%" height="100%"/></clipPath><path clip-path="url(#c)" pointer-events="visiblePainted" fill="#8ec7e1" d="M0 30h300v270H0z"/><ellipse cx="150" cy="30" rx="150" ry="30" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(150 120)"><tspan dy="0em" x="0">Event Store</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(150 160)"><tspan dy="0em" x="0">[Container: MongoDB]</tspan></text><image/></g><g transform="translate(709 2489)"><ellipse id="d" cx="420" cy="62.5" rx="30" ry="62.5" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1"/><path id="e" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1" d="M30 0h390v125H30z"/><clipPath id="f" clipPathUnits="userSpaceOnUse"><use xlink:href="#d" width="100%" height="100%"/><use xlink:href="#e" width="100%" height="100%"/></clipPath><path clip-path="url(#f)" pointer-events="visiblePainted" fill="#8ec7e1" d="M30 0h420v125H30z"/><ellipse cx="30" cy="62.5" rx="30" ry="62.5" stroke="#80b3cb" stroke-width="2" pointer-events="visiblePainted" fill="#8ec7e1"/><text font-size="34" y=".8em" font-weight="bold" text-anchor="middle" pointer-events="visible" font-family="'Open Sans'" transform="translate(225 17.5)"><tspan dy="0em" x="0">Event Bus</tspan></text><text font-size="19" y=".8em" text-anchor="middle" font-family="'Open Sans'" transform="translate(225 57.5)"><tspan dy="0em" x="0">[Container: NATS]</tspan></text><image/></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1240 704v280"/><path fill="#707070" stroke="#707070" d="M1230 984l10 20 10-20z"/><path fill="none" d="M1240 704v280"/><g cursor="move"><g transform="translate(1240 844)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="131.89999" height="33" transform="translate(-65.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Commands</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1157 1904l-117 282"/><path fill="#707070" stroke="#707070" d="M1030.4616 2181.69227l1.53845 22.3077 16.92308-14.6154z"/><path fill="none" d="M1157 1904l-117 282"/><g cursor="move"><g transform="translate(1098.5 2045)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="56.5" height="33" transform="translate(-27.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Uses</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1289 1904l132 282"/><path fill="#707070" stroke="#707070" d="M1411.48038 2190.10536l17.51954 13.89481.60413-22.35251z"/><path fill="none" d="M1289 1904l132 282"/><g cursor="move"><g transform="translate(1355 2045)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="56.5" height="33" transform="translate(-27.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Uses</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1465 1154h350"/><path fill="#707070" stroke="#707070" d="M1815 1164l20-10-20-10z"/><path fill="none" d="M1465 1154h350"/><g cursor="move"><g transform="translate(1640 1154)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="195.25" height="61.8" transform="translate(-97.2 -30.9)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -23.1)"><tspan dy="0em" x="0">Authorizes</tspan><tspan dy="1.2em" x="0">commands using</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M969 2504v368"/><path fill="#707070" stroke="#707070" d="M959 2872l10 20 10-20z"/><path fill="none" d="M969 2504v368"/><g cursor="move"><g transform="translate(969 2688)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="138.55" height="33" transform="translate(-68.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Publishes to</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1803 704l-359 288"/><path fill="#707070" stroke="#707070" d="M1437.37041 983.69735l-9.37043 20.30259 21.86433-4.68522z"/><path fill="none" d="M1803 704l-359 288"/><g cursor="move"><g transform="translate(1623.5 848)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="131.89999" height="33" transform="translate(-65.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Commands</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1499 2504v280"/><path fill="#707070" stroke="#707070" d="M1489 2784l10 20 10-20z"/><path fill="none" d="M1499 2504v280"/><g cursor="move"><g transform="translate(1499 2644)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="175.79999" height="33" transform="translate(-87.9 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Saves events to</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M677 704l359 288"/><path fill="#707070" stroke="#707070" d="M1030.13562 999.31484l21.86433 4.68522-9.37042-20.3026z"/><path fill="none" d="M677 704l359 288"/><g cursor="move"><g transform="translate(856.5 848)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="131.89999" height="33" transform="translate(-65.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Commands</tspan></text></g></g></g><g transform="translate(-35 -403)"><path stroke="#707070" stroke-width="2" stroke-dasharray="30, 30" fill="none" d="M1235 1304l-10 280"/><path fill="#707070" stroke="#707070" d="M1214.73953 1583.64694l9.26044 20.35299 10.72613-19.62015z"/><path fill="none" d="M1235 1304l-10 280"/><g cursor="move"><g transform="translate(1230 1444)" pointer-events="none"><rect fill="#fff" rx="3" ry="3" stroke="#fff" stroke-width="20" width="131.89999" height="33" transform="translate(-65.7 -16.5)"/><text font-size="24" y=".8em" text-anchor="middle" fill="#707070" font-family="'Open Sans'" transform="translate(0 -8.7)"><tspan dy="0em" x="0">Commands</tspan></text></g></g></g></svg>